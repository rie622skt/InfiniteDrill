# 解説文フォーマット仕様（全カテゴリ統一）

本ドキュメントは、InfiniteDrill の全出題カテゴリにおける「解説（explanation）」テキストのフォーマット・構成・表記ルールを一括で定義した仕様です。実装は `src/hooks/useSectionProblem.ts` をはじめ各 `use*Problem.ts` で行っています。

---

## 共通ルール

- **改行**: 解説は複数行のとき `"\n"` で結合（`explanationLines.join("\n")`）。
- **等号の使い分け**: 整数で割り切れる（または浮動小数点誤差の範囲で整数）なら **`=`**、そうでなければ **`≒`**。ヘルパー `eqOrApprox(value)` を使用（`useSectionProblem.ts` で定義）。
- **記号の統一**: 図の寸法と解説で同一記号を使う（例: フランジ幅は図も解説も **b**。大文字 B は中空断面の外幅など別定義の場合のみ）。
- **数値代入の徹底**: 公式の次に「数値を代入した式」を必ず1行以上挟み、暗算を排除する。ユーザーが計算用紙と照合しやすいようにする。
- **ステップ形式**: 複数の計算プロセスを要する問題では、T形断面 I（1.7）と同様に **① ② ③ …** の見出しで段階を明示し、アプリ全体で統一する。
- **単位変換の明記**: 応力度（N/mm²）を求める問題では、kN·m → N·mm（×10^6）または kN → N（×10^3）の変換を解説内に必ず記載する。
- **注記の定型文**: 符号・大きさに関する注記は下記の定型文を使用し、実装のブレを防ぐ（後述「注記テキストの定型文」参照）。

---

## 1. 断面の性質（section-properties）

### 1.1 長方形断面（Z / I）

| 対象 | フォーマット |
|------|----------------|
| **Z** | 1) 「長方形断面の断面係数 Z は Z = b×h²/6 で求めます。」<br>2) 「b = {b} mm, h = {h} mm より、」<br>3) 「Z = ({b} × {h}²) / 6」<br>4) 「  = ({b} × {h²}) / 6」<br>5) 「  = {answer} mm³」 |
| **I** | 1) 「長方形断面の断面二次モーメント I は I = b×h³/12 で求めます。」<br>2) 「b = {b} mm, h = {h} mm より、」<br>3) 「I = ({b} × {h}³) / 12」<br>4) 「  = ({b} × {h³}) / 12」<br>5) 「  = {answer} mm⁴」 |

### 1.2 中空長方形（ロの字）（Z / I）

| 対象 | フォーマット |
|------|----------------|
| **Z** | 1) 中空断面の説明（外側−内側）。<br>2) 「まず I = (B×H³ − b×h³) / 12 で…」<br>3) 「Z = I/(H/2) = 2×I/H で…」<br>4) 「I = (B×H³ − b×h³) / 12 = … = {I} mm⁴」<br>5) 「Z = 2×I / H = … = {Z} mm³」 |
| **I** | 1) 「中空長方形断面の断面二次モーメントは、外側から内側を引いて求めます。」<br>2) 「I = (B×H³ − b×h³) / 12」<br>3) 「= (B × H³ − b × h³) / 12」<br>4) 「= (BH³ − bh³) / 12」<br>5) 「= {I} mm⁴」 |

### 1.3 H形断面（Z / I）

| 対象 | フォーマット |
|------|----------------|
| **Z** | 1) 「H形断面は、フランジとウェブからなります。」<br>2) 「まず I = (b×h³ − (b−tw)×(h−2×tf)³) / 12 で…」<br>3) 「Z = I/(h/2) = 2×I/h で…」<br>4) 「I = … = {I} mm⁴」<br>5) 「Z = 2×I / h = … = {Z} mm³」 |
| **I** | 1) 「H形断面の断面二次モーメントは、外枠からウェブ部分の穴を引いて求めます。」<br>2) 「I = (b×h³ − (b−tw)×(h−2×tf)³) / 12」<br>3) 「= (b × h³ − (b−tw) × hw³) / 12」<br>4) 「= {I} mm⁴」 |

### 1.4 L形断面（図心 x_g）

- 1) 「L形断面の図心は、各部分の面積とその図心位置から求めます。」
- 2) 「左矩形: A1 = b1×h = {b1}×{h} = {A1} mm², 図心 x1 = b1/2 = {x1} mm」
- 3) 「右矩形: A2 = b2×h = {b2}×{h} = {A2} mm², 図心 x2 = b1 + b2/2 = {x2} mm」
- 4) 「全体の図心 x_g = (A1×x1 + A2×x2) / (A1 + A2)」
- 5) 「x_g = ({A1}×{x1} + {A2}×{x2}) / ({A1}+{A2}) {= or ≒} {x_g} mm」※ 具体的な数値代入を行い、`eqOrApprox(x_g)` で等号を切り替え。ユーザーが計算用紙と照合しやすいようにする。

### 1.5 L形断面（図心軸まわり I）※ステップ形式（T形1.7と同一フォーマット）

- 1) 「L形断面の断面二次モーメント I は、左右の矩形に分け、平行軸の定理（I = I_0 + A×d²）を用いて求めます。」
- 2) **① 各部の面積と図心**  
  - 左矩形: A1 = b1×h = … mm², 図心 x1 = b1/2 = … mm  
  - 右矩形: A2 = b2×h = … mm², 図心 x2 = b1 + b2/2 = … mm
- 3) **② 全体の図心位置 x_g**  
  - x_g = (A1×x1 + A2×x2) / (A1+A2) = ({A1}×{x1} + {A2}×{x2}) / ({A1}+{A2}) {= or ≒} {x_g} mm
- 4) **③ 各部の自軸まわり断面二次モーメント I_0**  
  - 左矩形: I_g1 = h×b1³/12 = … mm⁴、右矩形: I_g2 = h×b2³/12 = … mm⁴
- 5) **④ 図心までの距離 d**  
  - d1 = x_g − x1 {= or ≒} … mm、d2 = x2 − x_g {= or ≒} … mm
- 6) **⑤ 全体 I の合成**  
  - I1 = I_g1 + A1×d1² = … mm⁴, I2 = I_g2 + A2×d2² = … mm⁴  
  - 「図心軸まわりの I = I1 + I2 = {answer} mm⁴」

### 1.6 T形断面（図心 y_g）

- 1) 「T形断面の図心位置 y_g は、フランジとウェブを2つの長方形に分けて面積と図心位置から求めます。」
- 2) 「フランジ: 幅 B = {b} mm, 厚さ t_f = {tf} mm → 面積 A_f = B×t_f = {Af} mm², 図心 y_f = t_f/2 = {yF} mm」
- 3) 「ウェブ: 厚さ t_w = {tw} mm, 高さ h_w = h−t_f = {hw} mm → 面積 A_w = …, 図心 y_w = …」
- 4) 「図心位置は y_g = (A_f×y_f + A_w×y_w) / (A_f + A_w) で求めます。」
- 5) 「y_g = (Af×yF + Aw×yW) / (A) {= or ≒} {answer} mm」※ `eqOrApprox(y_g)` を使用

### 1.7 T形断面（断面二次モーメント I）※ステップ形式

- 1) 「T形断面の断面二次モーメント I は、フランジとウェブに分け、平行軸の定理（I = I_0 + A×d²）を用いて求めます。」
- 2) **① 各部の面積と図心（上端基準）**  
  - フランジ: 面積 A_f = b×t_f = … mm², 図心 y_f = t_f/2 = … mm  
  - ウェブ: 面積 A_w = t_w×h_w = … mm², 図心 y_w = t_f + h_w/2 = … mm
- 3) **② 全体の図心位置 y_g**  
  - y_g = (A_f×y_f + A_w×y_w)/(A_f+A_w) = … {= or ≒} … mm
- 4) **③ 各部の自軸まわり断面二次モーメント I_0**  
  - フランジ: I_f = b×t_f³/12 = … {= or ≒} … mm⁴  
  - ウェブ: I_w = t_w×h_w³/12 = … {= or ≒} … mm⁴
- 5) **④ 全体図心までの距離 d**  
  - フランジ: d_f = y_g − y_f {= or ≒} … mm  
  - ウェブ: d_w = y_w − y_g {= or ≒} … mm
- 6) **⑤ 全体 I の合成**  
  - 「I = (I_f + A_f×d_f²) + (I_w + A_w×d_w²) = (I_fR + Af×dF²) + (I_wR + Aw×dW²) = termF + termW {= or ≒} {answer} mm⁴」

※ 変数 A_f, A_w, y_f, y_w は必ず ① で数値付きで定義する。記号は図と一致させ **b**（小文字）を使用。

---

## 2. 曲げ応力度（bending-stress）

### 2.1 曲げ応力度 σ = M/Z（集中荷重）

- 1) 梁種別に応じて「まず片持ち梁の…」または「まず単純梁の中央集中荷重の…」
- 2) 「M_max = P×a」または「M_max = P×L/4」の説明と数値行
- 3) 空行
- 4) 「次に長方形断面の断面係数 Z を求めます（Z = b×h²/6）。」
- 5) 「b = …, h = … より、」「Z = … = … mm³」
- 6) 空行
- 7) 「曲げ応力度 σ は σ = M/Z で求めます。M を N·mm に変換すると、」
- 8) 「M_max = … kN·m = … × 10^6 N·mm」「σ = M_max / Z = … = {answer} N/mm²」

### 2.2 複合応力度 σ = N/A ± M/Z ※ステップ形式・単位変換必須

- **共通**: 応力度を求めるため、**単位変換（kN·m → N·mm は ×10^6、kN → N は ×10^3）を解説内に必ず明記**する。2.1 曲げ応力度と同様のトーンで統一。
- **ステップ形式**
  - **① 軸力による応力度**  
    - N = … kN = … × 10^3 N、A = b×h = … mm²  
    - σ_軸 = N/A = … N/mm²
  - **② 曲げによる応力度**  
    - M_max = … kN·m = … × 10^6 N·mm、Z = … mm³  
    - σ_曲げ = M/Z = … N/mm²
  - **③ 応力度の重ね合わせ**  
    - 圧縮側縁: σ = σ_軸 − σ_曲げ = … N/mm²  
    - 引張側縁: σ = σ_軸 + σ_曲げ = … N/mm²

---

## 3. 梁問題（単純梁・片持ち梁・等分布）

### 3.1 単純梁・集中荷重（M_max / V_A / V_B）

- **M_max**: 「M_max = (P × a × b) / L」→ 数値代入行 → 「= {num}/{L}」→ 「= {answer} kN·m」
- **V_A**: 「力の釣り合いにより、V_A = P × b / L」→ 代入行 → 「= {answer} kN」
- **V_B**: 「力の釣り合いにより、V_B = P × a / L」→ 代入行 → 「= {answer} kN」

### 3.2 単純梁・等分布（M_max / V_A,V_B）

- **M_max**: 「M_max = (w × L²) / 8」→ 代入・計算 → 「= {answer} kN·m」
- **V**: 「等分布荷重では… V_A = V_B = w × L / 2」→ 代入 → 「= {answer} kN」

### 3.3 単純梁・等分布（指定位置 x の M(x) / Q(x)）

- **M_at_x**: 「M(x) = w × x × (L − x) / 2」→ 代入 → 「= {answer} kN·m」
- **Q_at_x**: 「Q(x) = V_A − w×x = w×L/2 − w×x」→ 代入 → 「= {answer} kN」

### 3.4 片持ち梁・集中荷重（M_max / V_A）

- **M_max**: 「片持ち梁の固定端モーメントの大きさは…」「|M_max| = P × a」→ 代入 → 「= {answer} kN·m」＋ **注記定型文（大きさ）** を使用。
- **V_A**: 「片持ち梁の固定端の鉛直反力は…」「V_A = P」→ 「= {answer} kN」

---

## 4. 座屈（buckling）

### 4.1 座屈長さ l_k

- 1) 「座屈長さ l_k は支持条件によって、… l_k = γ×L で表されます。」
- 2) 「{支持条件}の場合、座屈長さ係数は γ = {gamma} です。」
- 3) 支持条件ごとの説明（一端固定・他端自由なら 2L、両端固定なら 0.5L など）
- 4) 「したがって l_k = {gamma} × {L} = {answer} m です。」

### 4.2 座屈荷重の比率（両端ピン柱の何倍か）

- 1) 「弾性座屈荷重はオイラーの公式 P_k = π²EI / l_k² で与えられます。」
- 2) 「同じ EI・同じ長さ L の柱では、P_k は l_k² に反比例… P_k ∝ 1/γ²」
- 3) 「両端ピン柱を基準（γ=1）とすると、この柱の座屈荷重は両端ピン柱の 1/γ² 倍です。」
- 4) 「{支持条件}では γ = {gamma} なので、1/γ² = 1/{γ²} = {answer} 倍です。」

---

## 5. トラス（truss）

### 5.1 山形トラス（底辺軸力）

- 支点反力 P/2 → 底辺軸力の説明（節点の水平つり合い、45° のとき cot(45°)=1）→ N_A = +{answer} kN → **注記定型文（符号）** を使用。

### 5.2 ゼロメンバー

- ゼロメンバーの定理の説明 → L字節点と部材Aの説明 → N_A = 0 kN → **注記定型文（符号）** を使用。

### 5.3 片持ちトラス（上弦A / 下弦B）

- 1) 「片持ちトラスで先端に荷重 P が作用するとき、第1パネルで切断し…」
- 2) 部材に応じてモーメント中心と式（上弦: 中央下節点・M=P×L→N=+P、下弦: 左上支点・M=P×2L→N=-2P）
- 3) 部材と N = {answer} kN の結論 → **注記定型文（符号）** を使用。

### 5.4 プラットトラス（部材A/B/C/D）

- 1) 「プラットトラス（…）で下弦中央に荷重 P、支点反力はそれぞれ P/2 です。」
- 2) 「図は {hLabel} の 3:4:5 です。」
- 3) 対象部材に応じた1行説明（A: 左斜材、B: 上弦、C: 下弦左、D: 中央垂直材）
- 4) 「部材{targetMember}（{memberLabel}）は N = {answer} kN です。」→ **注記定型文（符号）** を使用。

---

## 6. ラーメン（frame）

### 6.1 3ヒンジ・梁中央集中荷重

- 1) 「3ヒンジラーメン（門形で梁中央にヒンジ）で、梁中央に集中荷重 P … 対称より V_A = V_B = P/2」
- 2) 「左柱脚まわりのモーメントのつり合いから … H×h = (P/2)×(L/2) より H = P×L/(4h)」
- 3) 「左柱頭の曲げモーメントの大きさは M = H×h = P×L/4」
- 4) 「M = {P}×{L}/4 = {answer} kN·m」

### 6.2 3ヒンジ・梁上等分布荷重

- 1) 「3ヒンジラーメンで梁上に等分布荷重 w … V_A = V_B = w×L/2」
- 2) 「左柱脚まわりのモーメントのつり合い … H×h = … = w×L²/8」
- 3) 「左柱頭の曲げモーメントの大きさは M = H×h = w×L²/8」
- 4) 「M = {w}×{L}²/8 = {answer} kN·m」

### 6.3 3ヒンジ・柱頭水平荷重

- 1) 「3ヒンジラーメンの柱頭に水平荷重 P が作用すると…」
- 2) 「中央ヒンジ回りのモーメントつり合いを解くと … H_A = H_B = P/2」
- 3) 「左柱頭の曲げモーメント M = H_A×h = (P/2)×h」
- 4) 「M = ({P}/2)×{h} = {answer} kN·m」

---

## 7. たわみ（deflection）

### 7.1 倍率問題（初級・中級・上級の一部）

- 1) 構造に応じた公式の説明（単純梁中央: δ = PL³/(48EI)、片持ち先端: δ = PL³/(3EI)）
- 2) 「いずれも δ は L³ に比例し、1/EI に比例し、P に比例します。」
- 3) 変化させる変数（L / EI / P）に応じて「L を {mult} 倍にすると δ は {mult}³ = {answer} 倍」など。

### 7.2 大小比較 δ_A/δ_B（中級・上級）

- **出題**: 梁Aと梁Bを2本並べて表示し、「δ_A/δ_B を求めよ」と出題。本試験で多い「異なる構造間の比較」形式。
- **表示**: 梁A（単純梁 or 片持ち）・梁B（単純梁 or 片持ち）の L, P を info に明記。EI は両方同じとする。
- **解説**: ① 梁A・梁Bの公式をそれぞれ書く → ② δ_A, δ_B に数値代入 → ③ δ_A/δ_B の計算結果。答えは小数（0.0625, 0.5, 1, 2, 16 など）で、選択肢も同様。

---

## 注記テキストの定型文

実装のブレを防ぐため、以下の文言を**そのまま**使用する。コピー用にロックする。

| 用途 | 定型文 |
|------|--------|
| **大きさを問う場合**（曲げモーメントの絶対値など） | 「※本問では大きさを問うているため、絶対値（正の値）で解答します。」 |
| **符号を問う場合**（トラス軸力：引張・圧縮） | 「※建築士試験の慣例に従い、引張力を正（+）、圧縮力を負（-）とします。」 |

- 片持ち梁の M_max 解説の末尾 → 大きさを問う場合
- トラス（山形・ゼロメンバー・片持ち・プラット）の軸力解説の末尾 → 符号を問う場合

---

## 実装上の注意

- **eqOrApprox**: `useSectionProblem.ts` 先頭で定義。T形・L形の図心・I・d などで使用。
- **改行**: 空行は `""` を配列に push するか、テンプレート内に `\n` を含めない（join("\n") で統一）。
- **単位**: mm, mm², mm³, mm⁴, kN, kN·m, N/mm², m などを省略せず記載。
- **数値代入**: 公式の次の行で「具体的な数値を代入した式」を必ず記載し、答えの行では `eqOrApprox` で = / ≒ を切り替える。
- **新規カテゴリ追加時**: 本 MD に「フォーマット」と「変数定義の順序」を追記し、既存のステップ形式（①〜⑤）・等号ルール・注記定型文に揃える。
