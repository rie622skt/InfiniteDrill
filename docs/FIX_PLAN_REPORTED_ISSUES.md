# 指摘事項の精査結果と修正プラン

## 対応方針
- **修正する**: バグ・図の乖離・表示欠落（問題2, 3, 6, 7, 8, 10）
- **修正しない**: 問題なしと判断されたもの、軽微で実害なし、設計判断で現状維持とするもの（問題1, 4, 5, 9、D）

---

## B. 問題ロジックと図の乖離・バグ

### 問題1: 張り出し梁・集中荷重でスパン内のとき M図の張り出し区間が M=0
**判断: 修正不要**  
張り出し区間は荷重なしのため M=0 で正しい。指摘どおり「問題なし」。

---

### 問題2: 張り出し梁・等分布の Q図で張り出し区間のせん断力が不正確
**判断: 修正する（中）**  
- **現状**: `x > L` で `Q = w * (total - x)`  
- **正**: 支点Bの右では自由端側に向かって等分布が下向きに作用するため、せん断力は `Q = -w * (total - x)`（符号が逆）  
- **対応**: `BeamQDiagram.tsx` 108行目を `Q = -w * (total - x)` に変更。

---

### 問題3: 張り出し梁・等分布の M図で張り出し区間の M 計算が不正確
**判断: 修正する（中）**  
- **現状**: `M = Va*L - w*L²/2 - Vb*xi + w*xi²/2`（xi = x - L）で自由端で M≠0 になるバグあり。  
- **正**: 自由端からのつり合いで `M(x) = -w*(L+c-x)²/2`（x > L）。  
- **対応**: `BeamMDiagram.tsx` の x > L の else ブロックを `M = -w * (total - x) ** 2 / 2` に変更。

---

### 問題4: 張り出し梁の Va の符号
**判断: 修正不要**  
指摘内の検算で「Va = Pc/L は上向きで正。OK」と結論されている。

---

### 問題5: getDistributedQxWrong で正答が 0 のとき誤答候補から 0 が除外される
**判断: 修正不要（軽微）**  
正答が 0 のとき誤答候補が減るが、他候補で3つはほぼ確保できる。実害は軽微のため対応しない。

---

### 問題6: FrameDiagram の等分布荷重の矢印が上向き（下向きであるべき）
**判断: 修正する（中）**  
梁上等分布荷重は下向きに作用すべき。矢印の線・ポリゴンを「梁上面から下向き」に変更する。

---

### 問題7: 診断レポートの弱点カテゴリ表示で新カテゴリが生キー表示になる
**判断: 修正する（中）**  
- **現状**: switch で4カテゴリのみラベル変換し、それ以外は `cat` のまま表示。  
- **対応**: `HomeScreen.tsx` で `CATEGORY_LABELS[cat]` を使用（既にインポート済み）。switch を廃止し `rep.weakCategories.map(cat => CATEGORY_LABELS[cat])` に統一。

---

### 問題8: 苦手克服モードのレポートが旧4カテゴリのみ
**判断: 修正する（軽微）**  
- **現状**: 単純×集中/分布、片持ち×集中/分布の4つのみハードコード表示。  
- **対応**: `ALL_CATEGORIES` を map し、`stats[cat]` の正答率・正答数/総数を表示。未解答は 0/0 や「-」で表示。

---

### 問題9: DiagnosticRadarChart が旧4カテゴリのみ
**判断: 修正しない（設計判断）**  
12軸レーダーは可読性が悪い。診断レポート本文ですでに全カテゴリの正答率は出ているため、レーダーは「梁4種の概要」として現状のままとする。

---

### 問題10: FrameDiagram の集中荷重の矢印が上向き（下向きであるべき）
**判断: 修正する（中）**  
集中荷重も梁の上から下向きに作用すべき。矢頭を下向き（梁側）にし、線は荷重作用点から梁まで下向きに描く。

---

## D. 問題生成ロジック

- **誤答候補が3つ集まらないケース**: fallback でほぼ発生しない。現時点では対応不要。  
- **プラットトラスの誤答候補**: 重複は Set で除去されており実害なし。対応不要。

---

## 実施する修正一覧

| # | ファイル | 内容 |
|---|----------|------|
| 2 | BeamQDiagram.tsx | 張り出し・等分布の x>L で Q = -w*(total-x) |
| 3 | BeamMDiagram.tsx | 張り出し・等分布の x>L で M = -w*(total-x)²/2 |
| 6 | FrameDiagram.tsx | 等分布荷重の矢印を梁から下向きに変更 |
| 10 | FrameDiagram.tsx | 集中荷重の矢印を下向きに変更 |
| 7 | HomeScreen.tsx | 弱点カテゴリ表示を CATEGORY_LABELS[cat] に統一 |
| 8 | HomeScreen.tsx | 苦手克服レポートを ALL_CATEGORIES で動的表示 |

以上を実施後、動作確認を行う。
