# トラス問題 指摘の精査結果と対応方針

コード（`useTrussProblem.ts`・`TrussDiagram.tsx`）と構造力学の理論を照合し、指摘が正しいか・修正が必要かを判断しました。

---

## パターン1: 山形トラス（simple-triangle）

**指摘**: 問題なし ✅  
**精査結果**: **指摘どおり。修正不要。**

- 底辺軸力 N = (P/2)cot(45°) = P/2（引張）。コード `answer = P/2` と一致。
- 図・問題文も適切。

---

## パターン2: ゼロメンバー（zero-member）

**指摘**: ハイライトされる「部材A」がゼロメンバーではない（重大バグ）🔴  
**精査結果**: **指摘は正しい。修正が必要。**

**根拠（コード確認）**  
- `TrussDiagram.tsx` 262–272行: L字節点 `(lNodeX, lNodeY)` に接続する部材は次の3本。
  1. 左下節点 → L字節点（左斜材）
  2. L字節点 → 右上節点（**部材A**。描画上は左斜材の延長線上: `topRightY = lNodeY + (leftDiagDy/leftDiagDx)*(topRightX - lNodeX)`）
  3. L字節点 → 右下節点（右斜材）

- ゼロメンバーの定理（3部材が1節点に接続・荷重なし）: 「2本が同一直線上なら、残り1本の軸力は0」
- 同一直線上にあるのは「左斜材」と「部材A」（左斜材の延長）。したがって**ゼロメンバーは「L字→右下」の右斜材**であり、**部材A（L字→右上）はゼロメンバーではない**。

**対応方針**:  
- **B案を採用**: ハイライト対象を「ゼロメンバーである右斜材（L字→右下）」に変更する。  
- 図では「部材A」のラベルを、現在オレンジで描いている「L字→右上」ではなく、「L字→右下」の線に付ける（`targetMember === "A"` のとき右斜材をハイライト）。  
- `useTrussProblem.ts` の `generateTrussZero` は `targetMember: "A"` のまま、解説文で「部材Aは荷重のないL字節点で、同一直線上にない方の1本なので N_A = 0」と記載する。  
- 図の「部材A」の定義を「L字節点から右下節点に向かう部材」に合わせる（TrussDiagram の zero-member で、A を右斜材として描画・ハイライトする）。

---

## パターン3: 片持ちトラス（cantilever-truss）

**指摘**: 軸力が2倍（2P）。正しくは P。壁モーメントと切断面モーメントの混同 🔴  
**精査結果**: **指摘は正しい。修正が必要。**

**根拠（断面法）**  
- 第1パネル（壁から距離 L の位置）で上弦・下弦・斜材を切断し、**切断面より右側**の自由体を考える。
- 右側に作用する外力は**先端の P のみ**。切断面から荷重までの距離は **L**（2L ではない）。
- 下弦切断点まわりのモーメント: \(P \times L = N_{\text{上弦}} \times h = N_{\text{上弦}} \times L\) → \(N_{\text{上弦}} = P\)（引張）。
- 上弦切断点まわりのモーメント: \(P \times L = |N_{\text{下弦}}| \times L\) → \(N_{\text{下弦}} = -P\)（圧縮）。
- コードの「壁に発生する曲げモーメント M = P×2L」は全体系の話であり、**断面法で使うのは切断面以遠の荷重による切断面まわりのモーメント P×L**。ここを混同しているため 2P になっている。

**対応方針**:  
- `useTrussProblem.ts`: `answer = targetMember === "A" ? P : -P` に変更。解説文の「M = P×2L」「N = 2P」を「切断面まわりのモーメント M = P×L」「N = P」に修正。

---

## パターン4: プラットトラス（pratt-truss）

**指摘**: 構造が不安定（部材不足）＋ 軸力計算値の誤り 🔴  
**精査結果**: **指摘は正しい。修正が必要。**

**根拠（コード上の部材数）**  
- `TrussDiagram.tsx` プラット: 節点6、部材は上弦2・下弦2・中央垂直1・斜材2 の **7本**。
- 静定トラス: \(m = 2n - 3 = 2 \times 6 - 3 = 9\) 本必要。\(7 < 9\) のため **不安定（メカニズム）**。
- 指摘どおり、左右端の垂直材が欠けており、現状の軸力式（5P/6, -2P/3 等）は別の安定したプラットを仮定したものと考えられる。不安定構造のまま現在の数値を出題するのは不適切。

**対応方針**:  
- **構造を安定化する**: 左端垂直材・右端垂直材を図と計算に追加し、部材数を 9 本にする（2スパン・6節点の静定プラットとして再設計）。
- そのうえで、全部材の軸力を正しく計算し直し、A/B/C/D の答えと解説を更新する。
- 実装工数が大きい場合は、一時的にプラットを「出題から外す」か、より単純な安定トラス（例: ワーレンなど）に差し替える選択肢もある。推奨は「左右端垂直材を追加して安定化し、軸力を再計算」。

---

## 軽微な指摘

### 問題4（軽微）: 荷重矢印が節点から離れる方向

**指摘**: 建築図法では荷重は「節点に向かって」描くのが慣例。現状は「節点から離れる」向き。  
**方針**: 機能的には誤りではない。余裕があれば、荷重矢印を「作用点に矢先が当たる」形に統一する。優先度は低い。

### 問題5（軽微）: プラットの L 表示

**指摘**: 問題文で「L = 4 m」、図で「2L = 8 m」となり、L が片側スパンか全体か紛らわしい。  
**方針**: プラット修正（構造・軸力）とあわせて、「スパン 2L = ○ m」などと明示する表記にするとよい。プラットの大修正時に含める。

---

## まとめ（どうするか）

| # | パターン | 指摘の正否 | 対応 |
|---|----------|------------|------|
| 1 | 山形 | 問題なし | **修正不要** |
| 2 | ゼロメンバー | ✅ 正しい | **要修正**: 部材Aを「ゼロメンバーである右斜材（L字→右下）」に変更（図のハイライトと説明の一致） |
| 3 | 片持ち | ✅ 正しい | **要修正**: 軸力を 2P/-2P → P/-P に、解説を切断面モーメント P×L に合わせて修正 |
| 4 | プラット | ✅ 正しい | **要修正**: 左右端垂直材を追加して安定化し、軸力を再計算（または一時的に出題外/別トラスに変更） |
| 5 | 荷重矢印 | 慣例の差 | **任意**: 余裕があれば「節点に向かう」矢印に統一 |
| 6 | L 表示 | 紛らわしい | **任意**: プラット修正時に「2L」を明示 |

**実施順序の提案**: まずパターン2・3（修正範囲が明確で影響が大きい）を対応し、その後にパターン4（構造変更＋軸力再計算）に着手する。

---

## 対応済み（実装内容）

- **パターン2**: 部材Aのハイライトを「L字→右上」から「L字→右下」（ゼロメンバーである右斜材）に変更。解説を「3部材のうち同一直線上にない1本がゼロメンバー」に修正。
- **パターン3**: 答えを 2P/-2P → P/-P に変更。解説を「切断面まわりのモーメント P×L」「N = P」に修正。
- **パターン4**: 図に左右端垂直材を追加（静定化）。軸力を A=5P/6, B=-2P/3, C=0, D=-P/2 に再計算。解説・情報行（スパン 2L 表記）を更新。
